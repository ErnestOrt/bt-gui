<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>BikeTeam Team Dashboard</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>

<link th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
<link th:href="@{/css/bootstrap-responsive.min.css}" rel="stylesheet"/>
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,600" rel="stylesheet"/>
<link th:href="@{/css/font-awesome.css}" rel="stylesheet"/>
<link th:href="@{/css/style.css}" rel="stylesheet"/>
<link th:href="@{/css/pages/dashboard.css}" rel="stylesheet"/>


</head>
<body>
	<div class="navbar navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<a class="btn btn-navbar" data-toggle="collapse"
					data-target=".nav-collapse"><span class="icon-bar"></span><span
					class="icon-bar"></span><span class="icon-bar"></span> </a><a
					class="brand" href="index.html">Teambike</a>
				<div class="nav-collapse">
					<ul class="nav pull-right">
						<li class="dropdown"><a href="#" class="dropdown-toggle"
							data-toggle="dropdown"> Ernest Ortuño <b class="caret"></b></a>

							<ul class="dropdown-menu">
								<li><a href="javascript:;">Profile</a></li>
								<li><a href="javascript:;">Logout</a></li>
							</ul></li>
					</ul>
				</div>
			</div>
			<!--/.nav-collapse -->
		</div>
		<!-- /container -->
	</div>
	<!-- /navbar-inner -->
	
	<!-- /navbar -->
	<div class="subnavbar">

		<!-- /subnavbar-inner -->
	</div>
	<!-- /subnavbar -->
	<div class="main">
		<div class="main-inner">
			<div class="container">
				<div class="row">
					<div class="span6">
						<div class="widget">
							<div class="widget-header">
								<i class="icon-bookmark"></i>
								<h3>What to see</h3>
							</div>
							<!-- /widget-header -->
							<div class="widget-content">
								<div class="shortcuts">
									<a href="/dashboard;" class="shortcut shortcut-active"><i class="shortcut-icon icon-globe"></i><span class="shortcut-label">Team</span></a>
					                <a href="/profile" class="shortcut"><i class="shortcut-icon icon-user"></i><span class="shortcut-label">Profile</span></a>
					                <a href="/stages" class="shortcut"><i class="shortcut-icon icon-picture"></i><span class="shortcut-label">Statges</span></a>
					                <a href="/members" class="shortcut"><i class="shortcut-icon icon-group"></i> <span class="shortcut-label">Members</span></a>
								</div>
								<!-- /shortcuts -->
							</div>
							<!-- /widget-content -->
						</div>
						<!-- /widget -->
						<div class="widget">
							<div class="widget-header">
								<i class="icon-cloud"></i>
								<h3>Weather</h3>
							</div>
							<!-- /widget-header -->
							<div class="widget-content">
								<iframe id="forecast_embed" type="text/html" frameborder="0" height="245" width="100%" th:src="'http://forecast.io/embed/#lat=' + ${stageCloser.stagePoints[0].latitude} + '&amp;lon=' + ${stageCloser.stagePoints[0].longitude} + '&amp;name=' + ${stageCloser.name} + '&amp;units=ca'"> </iframe>

							</div>
							<!-- /widget-content -->
						</div>
						<!-- /widget -->
						<div class="widget widget-nopad">
							<div class="widget-header">
								<i class="icon-calendar"></i>
								<h3>Calendar</h3>
							</div>
							<!-- /widget-header -->
							<div class="widget-content">
								<div id='calendar'></div>
							</div>
							<!-- /widget-content -->
						</div>
						<!-- /widget -->
						<div class="widget">
							<div class="widget-header">
								<i class="icon-comments-alt"></i>
								<h3>Comments</h3>
								<a href="#modal-personal-information" role="button" class="btn" data-toggle="modal">Comment</a>

								<!-- Modal -->
								<div id="modal-personal-information" class="modal hide fade" tabindex="-1"
									role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
										<h3 id="myModalLabel">Comment</h3>
									</div>
									<div class="modal-body">
										<div class="control-group">											
											<div class="controls">
												<input type="text" class="span5" id="input-comment"></input>
											</div>				
										</div>
									</div>
									<div class="modal-footer">
										<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
										<button class="btn btn-primary" onclick="comment()">Comment</button>
									</div>
								</div>
							</div>
							<!-- /widget-header -->
							<div class="widget-content">
								<ul class="messages_layout">
									<li class="from_user left" th:each="comment : ${comments}"><a href="#" class="avatar"><img width="50px" height="50px" th:src="@{'/img/avatar/avatar_' + ${comment.ownerIcon} + '.png'}" /></a>
										<div class="message_wrap">
											<span class="arrow"></span>
											<div class="info">
												<a class="name" th:href="'/member/' + ${comment.ownerId}" th:text="${comment.ownerName}"></a> <span class="time" th:text="${comment.creationDate}"></span>
												<div class="options_arrow">
													<div class="dropdown pull-right">
														<a class="dropdown-toggle " id="dLabel" role="button"
															data-toggle="dropdown" data-target="#" href="#"> <i
															class=" icon-caret-down"></i>
														</a>
														<ul class="dropdown-menu " role="menu"
															aria-labelledby="dLabel">
															<li><a href="#"><i class=" icon-share-alt icon-large"></i> Reply</a></li>
															<li><a href="#"><i class=" icon-trash icon-large"></i> Delete</a></li>
															<li><a href="#"><i class=" icon-share icon-large"></i> Share</a></li>
														</ul>
													</div>
												</div>
											</div>
											<div class="text" th:text="${comment.content}"></div>
										</div></li>
								</ul>
							</div>
							<!-- /widget-content -->
						</div>
						<!-- /widget -->
					</div>
					<!-- /span6 -->
					<div class="span6">
						
						<div class="widget widget-nopad">
							<div class="widget-header">
								<i class="icon-bookmark"></i>
								<h3>Today's Stats</h3>
							</div>
							<!-- /widget-header -->
							<div class="widget-content">
								<div class="widget big-stats-container">
									<div class="widget-content">
										<h6 class="bigstats">This numbers define you team so make
											them grows as much as posible! And remember, keep riding!</h6>
										<div id="big_stats" class="cf">
											<div class="stat">
												<i class="icon-group"></i> <span class="value" th:text="${totalMembers}"></span>
												Memebers
											</div>
											<!-- .stat -->

											<div class="stat">
												<i class="icon-picture"></i> <span class="value" th:text="${totalStages}"></span>
												Statges
											</div>
											<!-- .stat -->

											<div class="stat">
												<i class="icon-road"></i> <span class="value" th:text="${totalKilomiters}"></span> Km
											</div>
											<!-- .stat -->

											<div class="stat">
												<i class="icon-cog"></i> <span class="value" th:text="${totalBikes}"></span>
												Bikes
											</div>
											<!-- .stat -->
										</div>
									</div>
									<!-- /widget-content -->

								</div>
							</div>
						</div>

						<div class="widget">
							<div class="widget-header">
								<i class="icon-picture"></i>
								<h3><a th:href="'/stage/' + ${stageCloser.id}" th:text="${stageCloser.name} + '[' + ${stageCloser.date} + ']'"></a></h3>
							</div>
							<!-- /widget-header -->
							<div class="widget-content">
								<canvas id="area-chart" class="chart-holder" height="250"
									width="538"> </canvas>
								<!-- /area-chart -->
							</div>
							<!-- /widget-content -->
						</div>
						<!-- /widget -->
						<div class="widget" >
				            <div class="widget-header"> <i class="icon-check"></i>
				              <h3>Who is going?</h3> 
				            </div>
							<div class="widget-content">
								<table class="table table-striped table-bordered">
									<thead>
										<tr>
											<th>Member</th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="member : ${members}">
											<td th:if="${#sets.contains(member.stagesIdsJoined, stageCloser.id)} == true" style="background-color: #ACFA58 !important" th:text="${member.name}"></td>
											<td th:if="${#sets.contains(member.stagesIdsJoined, stageCloser.id)} == false" style="background-color: #F78181 !important" th:text="${member.name}"></td>
										</tr>
									</tbody>
								</table>
							</div>
				          </div>
						<!-- /widget -->
						<div class="widget widget-nopad">
							<div class="widget-header">
								<i class="icon-list-alt"></i>
								<h3>Recent News</h3>
							</div>
							<!-- /widget-header -->
							<div class="widget-content">
								<ul class="news-items">
									<li>

										<div class="news-item-date">
											<span class="news-item-day">19</span> <span
												class="news-item-month">Nov</span>
										</div>
										<div class="news-item-detail">
											<a
												href="http://www.cyclingnews.com/news/tour-of-oman-stage-4-video-highlights/"
												class="news-item-title" target="_blank">Tour of Oman
												stage 4 video highlights</a>
											<p class="news-item-preview">n the final 2km, the lead
												group of four is headed up by Dimension Data's Merhawi
												Kudus, the 22-year-old Eritrean climbing sensation. He's
												out-matched by Romain Bardet (AG2R La Mondiale) who...</p>
										</div>

									</li>
									<li>

										<div class="news-item-date">
											<span class="news-item-day">18</span> <span
												class="news-item-month">Nov</span>
										</div>
										<div class="news-item-detail">
											<a
												href="http://www.cyclingnews.com/news/cancellara-surprised-by-algarve-time-trial-victory/"
												class="news-item-title" target="_blank">Cancellara
												surprised by Algarve time trial victory</a>
											<p class="news-item-preview">App Landing is a retina
												ready responsive app landing page website template perfect
												for software and application developers and small business
												owners looking to promote their iPhone, iPad, Android Apps
												and software products...</p>
										</div>

									</li>
									<li>

										<div class="news-item-date">
											<span class="news-item-day">18</span> <span
												class="news-item-month">Nov</span>
										</div>
										<div class="news-item-detail">
											<a
												href="http://www.cyclingnews.com/news/cancellara-surprised-by-algarve-time-trial-victory/"
												class="news-item-title" target="_blank">End of the line
												for Horner?</a>
											<p class="news-item-preview">Horner, who turned 44 last
												week, raced this season with the Continental Airgas-Safeway
												squad after facing a similarly unfruitful contract hunt last
												year after he was not renewed with Lampre-Merida...</p>
										</div>

									</li>
								</ul>
							</div>
							<!-- /widget-content -->
						</div>
						<!-- /widget -->
					</div>
					<!-- /span6 -->
				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
		</div>
		<!-- /main-inner -->
	</div>
	<!-- /main -->
	<div class="extra">
		<div class="extra-inner">
			<div class="container">
				<div class="row">
					<div class="span3">
						<h4>Support</h4>
						<ul>
							<li><a href="javascript:;">Frequently Asked Questions</a></li>
							<li><a href="javascript:;">Ask a Question</a></li>
							<li><a href="javascript:;">Video Tutorial</a></li>
							<li><a href="javascript:;">Feedback</a></li>
						</ul>
					</div>
					<!-- /span3 -->

					<!-- /span3 -->
				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
		</div>
		<!-- /extra-inner -->
	</div>
	<!-- /extra -->
	<div class="footer">
		<div class="footer-inner">
			<div class="container">
				<div class="row">
					<div class="span12"> &copy; 2016 BikeTeam</div>
					<!-- /span12 -->
				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
		</div>
		<!-- /footer-inner -->
	</div>
	<!-- /footer -->
	<!-- Le javascript
================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script th:src="@{/js/jquery-1.7.2.min.js}"></script>
	<script th:src="@{/js/excanvas.min.js}"></script>
	<script th:src="@{/js/chart.min.js}" type="text/javascript"></script>
	<script th:src="@{/js/bootstrap.js}"></script>
	<script language="javascript" type="text/javascript" th:src="@{/js/full-calendar/fullcalendar.min.js}"></script>

	<script th:src="@{/js/base.js}"></script>
	<script th:inline="javascript">
	
	/*<![CDATA[*/
	var lineChartData
	var valuesStage =[];
	var valuesBackground =[];
	var labelsKilomiters = [];
    var stagePointsList = [[${stageCloser.stagePoints}]]
    	
   	valuesBackground.push(0);
   	valuesBackground.push(1000);
   	
   	for(indexStagePoint = 0; indexStagePoint < stagePointsList.length; indexStagePoint++){
   		labelsKilomiters.push(stagePointsList[indexStagePoint].kilomiter);
   		valuesStage.push(stagePointsList[indexStagePoint].altitude);
	    if(indexStagePoint>=2){
			valuesBackground.push(0);
	  	}

   	}
   	
   	lineChartData = {
               labels:  labelsKilomiters,
               datasets: [
				{
				    fillColor: "rgba(255,255,255,0)",
    				    strokeColor: "rgba(255,255,255,0)",
    				    pointColor: "rgba(255,255,255,0)",
    				    pointStrokeColor: "#FFFFFF",
    				    pointHighlightFill: "#FFFFFF",
    				    pointHighlightStroke: "rgba(255,255,255,0)",
				    data: valuesBackground
				},
   				{
   				    fillColor: "rgba(151,187,205,0.5)",
   				    strokeColor: "rgba(151,187,205,1)",
   				    pointColor: "rgba(151,187,205,1)",
   				    pointStrokeColor: "#fff",
   				    data: valuesStage
   				}
   			]

           }
   	new Chart(document.getElementById("area-chart").getContext("2d")).Line(lineChartData);
    
    
	/*]]>*/
		
		
		
		
		/*<![CDATA[*/
		$(document).ready(function() {
			var date = new Date();
			var d = date.getDate();
			var m = date.getMonth();
			var y = date.getFullYear();

			var eventsArray = [];
			var stagesList = [[${stages}]];
			var colorEvent;
			var userId = [[${memberId}]]
			
			for (i = 0; i < stagesList.length; i++) {
				if(stagesList[i].joinedMembers.indexOf(userId) != -1){
					colorEvent='#67FA67';
				}else{
					colorEvent='#F78181';
				}
				
				eventsArray.push({title : stagesList[i].name, start : new Date(stagesList[i].date), url: "./stage/"+stagesList[i].id, color: colorEvent});
			}
			
			var calendar = $('#calendar').fullCalendar({
				header : {
					left : 'prev,next today',
					center : 'title',
					right : 'month,agendaWeek,agendaDay'
				},
				selectable : false,
				selectHelper : true,
				editable : false,
				events : eventsArray
			});
		});
		/*]]>*/
		
		function comment(){
		if($("#input-comment").val() != ""){
			$.ajax({
	   		    url : "/dashboard/comment/create",
	   		    type: "POST",
	   		    data : {content: $("#input-comment").val()},
	   		    success: function(data, textStatus, jqXHR) { location.reload(); }
	   		});
		}
    }
	</script>
	<!-- /Calendar -->
</body>
</html>
